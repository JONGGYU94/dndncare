<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
	<meta charset="UTF-8">
	<title>관리자_회원관리 페이지입니다.</title>
	<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz" crossorigin="anonymous"></script>
    <script src="https://code.jquery.com/jquery-3.2.1.js"></script>
	<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
	<style>
		#graphDiv {
			display: grid; grid-template-columns: 1fr 50px 1fr; grid-template-rows: 400px;
		}
		.selectState{background: lightyellow;}
		.table td{cursor: pointer;}
		.table td>div{border: 1px solid black; height: 80%; width: 33%; display: inline-block; padding-top: 3%; cursor: pointer;}
	</style>
</head>
<body>
	<div th:replace="~{common/adminNavbarTemp :: navbarTemp}"></div>
	<div th:replace="~{common/adminSymbolTemp :: symbolTemp}"></div>
	
	<div class="container-fluid">
		<div class="row">
			<div th:replace="~{common/adminbarTemp :: sidebar}"></div>
			
			<main class="col-md-9 ms-sm-auto col-lg-10 px-md-4">
				<div id="graphDiv">
					<div class="h-100 p-2 bg-light border rounded-3 text-center">
						<canvas id="barChart"></canvas>
					</div>
					
					<div><!-- 사이공백 --></div>
					
					<div class="h-100 p-2 bg-light border rounded-3 text-center">
						<canvas id="pieChart"></canvas>
					</div>
				</div>	
				
				<br/>
				
				<div>	
					<div id="tableDiv">
						<form method="get" action="searchMembers.adm" id="searchForm" style="display:grid; grid-template-columns:150px 200px 1fr;">
							<select class="form-select" name="searchOption">
								<option value="none">검색조건 선택</option>
								<option value="memberId">아이디</option>
								<option value="memberNo">회원번호</option>
							</select>
							
							<input type="text" class="form-control" name="searchContent"/>
							
							<div>
								<button class="btn btn-warning" type="button" id="searchMembers">검색하기</button>
								<button class="btn btn-primary" type="button" id="recentMembers">최근 가입회원</button>
								<button class="btn btn-primary" type="button" id="allMembers">전체 회원</button>
							</div>
						</form>
					
						<br/>
						
						<table class="table table-hover text-center" id="caregiverTable">
							<thead>
								<tr>
								<!-- ID		NAME	NICKNAME	EMAIL	GENDER	AGE		PHONE		ADDRESS		ENROLL		ADMIN		STATUS -->
									<th>회원번호</th>
									<th>아이디</th>
									<th>이름</th>
									<th>성별</th>
									<th>나이</th>
									<th>이메일</th>
									<th>주소지</th>
									<th>가입일</th>
									<th>가입상태</th>
									<th>회원그룹</th>
								</tr>
							</thead>
							<tbody>
								<tr th:each="m : ${mList}">
									<td>[[${m.memberNo}]]</td>
									<td>[[${m.memberId}]]</td>
									<td>[[${m.memberName}]]</td>
									<td>[[${m.memberGender}]]</td>
									<td>
										[[${m.memberRealAge}]]
									</td>
									<td>
										[[${m.memberEmail}]]
									</td>
									<td>
										[[${#strings.listSplit(m.memberAddress, '//').get(1)}]]
									</td>
									<td>
										[[${m.memberCreateDate}]]
									</td>
									<td>
										<div th:class="${m.memberStatus == 'Y' ? 'selectState' : ''}">Y</div>
										<div th:class="${m.memberStatus == 'N' ? 'selectState' : ''}">N</div>
									</td>
									<td>
										<div th:class="${m.memberCategory == 'C' ? 'selectState' : ''}">C</div><div th:class="${m.memberCategory == 'P' ? 'selectState' : ''}">P</div><div th:class="${m.memberCategory == 'A' ? 'selectState' : ''}">A</div>
									</td>
								</tr>
							</tbody>
						</table>
						
						
						<div class="btn-toolbar mb-3" role="toolbar" aria-label="Toolbar with button groups">
							<div class="btn-group me-2 text-end" role="group" aria-label="First group">
								<!-- 이전 버튼 -->
								<button type="button" class="btn btn-outline-secondary" th:if="${pi.currentPage <= 1}" disabled>Previous</button>
								<button type="button" class="btn btn-outline-secondary" th:if="${pi.currentPage > 1}" th:onclick="|location.href='@{${loc}(page=${pi.currentPage - 1}, searchOption=${searchOption}, searchContent=${searchContent})}'|">Previous</button>
								
								<!-- 숫자 버튼 -->
								<th:block th:each="p: ${#numbers.sequence(pi.startPage, pi.endPage)}">
						    		<button type="button" class="btn btn-outline-secondary" th:onclick="|location.href='@{${loc}(page=${p}, searchOption=${searchOption}, searchContent=${searchContent})}'|">[[${p}]]</button>
								</th:block> 
							    
							    <!-- 다음 버튼 -->
							    <button type="button" class="btn btn-outline-secondary" th:if="${pi.currentPage >= pi.maxPage}" disabled>Next</button>
							    <button type="button" class="btn btn-outline-secondary" th:if="${pi.currentPage < pi.maxPage}" th:onclick="|location.href='@{${loc}(page=${pi.currentPage+1}, searchOption=${searchOption}, searchContent=${searchContent})}'|">Next</button>
							</div>
						</div>
					</div>
					
					<div><!-- 사이공백 --></div>
				</div>
			</main>
		</div>
	</div>
	
	
	<!-- 회원정보 조회용 Scrollable modal (시작) -->
	<div class="modal fade" id="staticBackdrop" data-bs-backdrop="static" data-bs-keyboard="false" tabindex="-1" aria-labelledby="staticBackdropLabel" aria-hidden="true">
		<div class="modal-dialog">
		    <div class="modal-content">
		    	<div class="modal-header">
			        <h1 class="modal-title fs-5" id="staticBackdropLabel">Modal title</h1>
			        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
		        </div>
			    <div class="modal-body">
			    	<div class="modal-dialog modal-dialog-scrollable" id="modalContent">
			        
			        </div>
			    </div>
			    <div class="modal-footer">
			        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">닫기</button>
			        <!-- <button type="button" class="btn btn-primary">확인</button> -->
			    </div>
		    </div>
		</div>
	</div>
	<!-- 회원정보 조회용 Scrollable modal (끝) -->
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	<script>
		window.onload = () => {
			document.querySelector('#recentMembers').addEventListener('click', () => {
				location.href = 'members.adm';	
			})
			
			document.querySelector('#allMembers').addEventListener('click', () => {
				location.href = 'allMembers.adm';	
			})
			
			
			document.querySelector('#searchMembers').addEventListener('click', (event) => {
				const searchForm = document.querySelector('#searchForm');
				const searchOption = document.getElementsByName('searchOption')[0];
				const searchContent = document.getElementsByName('searchContent')[0];
				
				if(searchOption.children[0].selected || searchContent.value.trim() == ''){
					event.preventDefault();
					alert('검색 조건을 선택해주세요');
					if(searchOption.children[0].selected) searchOption.focus();
					else searchContent.focus();
				} else {
					searchForm.submit();
				}
			})
			
			const tbody = document.querySelector('tbody');
			
			tbody.addEventListener('click', (event) => {
				// 클릭에서 제외시키고 싶은 파트 => 타겟의 자식이 2명이상 존재하는 경우, 타겟의 태그명이 DIV인 경우
				if(event.target.children.length == 0 && event.target.tagName != 'DIV'){
					
					console.log('여기여기')
				}
				
				
				
				
			});
			
			
			
			
			
			
			
			
			
			
		}
	</script>
</body>
</html>