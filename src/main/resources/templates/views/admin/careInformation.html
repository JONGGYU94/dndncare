<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org">
<head>
	<meta charset="UTF-8">
	<title>관리자의 간병백과 페이지</title>
	<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz" crossorigin="anonymous"></script>
    <script src="https://code.jquery.com/jquery-3.2.1.js"></script>
	<!-- Editor's Style -->
	<link rel="stylesheet" href="https://uicdn.toast.com/editor/latest/toastui-editor.min.css" />
	<style>
		#graphDiv {
			display: grid; grid-template-columns: 1fr 50px 1fr; grid-template-rows: 400px;
		}
		.selectState{background: lightyellow;}
		.table td{cursor: pointer;}
		.table td>div{border: 1px solid black; height: 80%; width: 45%; display: inline-block; padding-top: 3%; cursor: pointer;}
	</style>
</head>
<body>
	<div th:replace="~{common/adminNavbarTemp :: navbarTemp}"></div>
	<div th:replace="~{common/adminSymbolTemp :: symbolTemp}"></div>

	<div class="container-fluid">
		<div class="row">
			<div th:replace="~{common/adminbarTemp :: sidebar}"></div>

			<main class="col-md-9 ms-sm-auto col-lg-10 px-md-4">
				<div id="graphDiv">
					<div class="h-100 p-5 bg-light border rounded-3">그래프 자리</div>
					<div><!-- 사이공백 --></div>
					<div class="h-100 p-5 bg-light border rounded-3">그래프 자리</div>
				</div>	
				
				<br/>
				
				<div>	
					<div>
						<table class="table table-hover text-center" id="careInformationTable">
							<thead>
								<tr>
									<th>번호</th>
									<th>제목</th>
									<th>작성자</th>
									<th>작성일</th>
									<th>조회수</th>
									<th>상태</th>
								</tr>
							</thead>
							<tbody>
								<tr th:each="b : ${bList}">
									<td>[[${b.boardNo}]]</td>
									<td>[[${b.boardTitle}]]</td>
									<td>[[${b.memberNickName}]]</td>
									<td>[[${b.boardUpdateDate}]]</td>
									<td>[[${b.boardCount}]]</td>
									<td>
										<div th:class="${b.boardStatus == 'Y' ? 'selectState' : ''}">Y</div>
										<div th:class="${b.boardStatus == 'N' ? 'selectState' : ''}">N</div>
									</td>
								</tr>
							</tbody>
						</table>
						<div style="display:grid; grid-template-columns:100px 1fr 300px;">
							<form>
								<button type="button" class="btn btn-primary" id="writeBtn">글 쓰기</button>
							</form>
							<div><!-- 버튼 사이 공백 --></div>
							<div>
								<div class="btn-toolbar mb-3" role="toolbar" aria-label="Toolbar with button groups">
									<div class="btn-group me-2 text-end" role="group" aria-label="First group">
										<!-- 이전 버튼 -->
										<button type="button" class="btn btn-outline-secondary" th:if="${pi.currentPage <= 1}" disabled>Previous</button>
	 									<button type="button" class="btn btn-outline-secondary" th:if="${pi.currentPage > 1}" th:onclick="|location.href='@{${loc}(page=${pi.currentPage - 1})}'|">Previous</button>
										
										<!-- 숫자 버튼 -->
										<th:block th:each="p: ${#numbers.sequence(pi.startPage, pi.endPage)}">
								    		<button type="button" class="btn btn-outline-secondary" th:onclick="|location.href='@{${loc}(page=${p})}'|">[[${p}]]</button>
										</th:block> 
									    
									    <!-- 다음 버튼 -->
									    <button type="button" class="btn btn-outline-secondary" th:if="${pi.currentPage >= pi.maxPage}" disabled>Next</button>
									    <button type="button" class="btn btn-outline-secondary" th:if="${pi.currentPage < pi.maxPage}" th:onclick="|location.href='@{${loc}(page=${pi.currentPage+1})}'|">Next</button>
									</div>
								</div>
							</div>
						</div>
					</div>
					
					<div><!-- 사이공백 --></div>
					
					<div class="h-100 p-1 bg-light border rounded-3">
						<!-- 글 상세내용이 들어올 공간 -->
						<div id="careInformationDetail" style="height: 85%">글 상세 내용이 들어올 공간</div>
						
						<div class="text-center align-middle" style="height:15%;">
							<button class="btn btn-light" disabled>수정하기</button>&nbsp;&nbsp;&nbsp;&nbsp;
							<button class="btn btn-light" disabled>내리기</button>
						</div>
					</div>
				</div>
			</main>
		</div>
	</div>
	
	<script src="https://uicdn.toast.com/editor/latest/toastui-editor-all.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.2.1/dist/chart.umd.min.js" integrity="sha384-gdQErvCNWvHQZj6XZM0dNsAoY4v+j5P1XDpNkcM3HJG1Yx04ecqIHk7+4VBOCHOG" crossorigin="anonymous"></script>
	<script th:inline="javascript">
		window.onload = () => {
			// 간병백과 글 쓰기 페이지로 이동(시작)
			document.querySelector('#writeBtn').addEventListener('click', () => {
				location.href = 'writeCareInformationPage.adm';
			})
			// 간병백과 글 쓰기 페이지로 이동(끝)
			
			//글 상세보기 요청(시작)
			const tdList = document.getElementById('careInformationTable').querySelectorAll('td');
			const detailDiv = document.querySelector('#careInformationDetail'); // 글 내용을 삽입해야할 div
			const btnDiv = detailDiv.nextElementSibling;
			const btnList = btnDiv.children;
			
			for(let i = 0; i < tdList.length; i++){
				let index = i % 6;
				
				if(index != 5) {
					tdList[i].addEventListener('click', function() {
						for(const other of tdList){
							if(other != this){
								other.parentElement.style.background = 'white'; // 클릭하지 않은 tr의 배경색을 white로 변경
							}
						}
						this.parentElement.style.background = 'lightgray'; // 클릭한 tr의 배경색을 lightgray로 변경
						
						// 상세보기 div에 출력할 노드 작성(시작)
						const titleSpan = document.createElement('span');
						titleSpan.setAttribute("class", "badge rounded-pill bg-dark fs-6");
						titleSpan.innerText = '내용';
						
						const br = document.createElement('br');
						
						let content = '';
						/*<![CDATA[*/
						const bList = /*[[${bList}]]*/'bList'
						/*]]>*/
						for(const b of bList){
							if(this.parentElement.children[0].innerText == b.boardNo){
								content = b.boardContent;
								break;
							}
						}
						
						detailDiv.innerHTML = '<span class="badge rounded-pill bg-dark fs-6">내용</span><br/>' + content;
						
						for(let btn of btnList){
							btn.classList.remove('btn-light');
							btn.classList.add('btn-primary');
							btn.disabled = false;
						}
					})
				}
			}
			
			// 글 조회에서 수정과 삭제 요청 (시작)
			for(let i = 0; i < btnList.length; i++){
				btnList[i].addEventListener('click', () => {
					// 현재 조회중인 글에 대한 번호를 가져온다.
					const trList = document.querySelectorAll('tr');
					let targetTr = '';
					let bNo = '';
					for(let tr of trList){
						if(tr.style.background == 'lightgray') {
							bNo = tr.children[0].innerText; // 현재 선택중인 tr에 접근하여 글 번호를 가져옴
							targetTr = tr;
						}
					}
					
					if(i == 0){ // 수정하기 버튼 클릭
						const editorDiv = document.createElement('div');
						editorDiv.setAttribute('id', 'editor');	
						
						// 여기여기
						
						
						
						
					} else if(i == 1){ // 삭제하기 버튼 클릭
						$.ajax({
							url: 'deleteCareInformation.adm',
							type: 'POST',
							data: {boardNo : bNo},
							success: data => {
								console.log(data);
								console.log(targetTr.querySelectorAll('div'));
								if(data == 'success'){ // 삭제 성공
									detailDiv.innerHTML = ''; // 원래 있던 내용 초기화
									const divList = targetTr.querySelectorAll('div'); // 클릭한 tr에 있는 상태 div들에게 접근
									divList[0].className = ''; // Y에 대한 배경을 OFF
									divList[1].className = 'selectState'; // N에 대한 배경을 ON 
								} else if(data == 'fail') { // 삭제 실패
									alert('서비스 요청에 실패하였습니다');
								}
							},
							error: data=> console.log(data)
						});
					}
				})
			}
			// 글 조회에서 수정과 삭제 요청 (끝)
			
			
			
		}
	</script>
</body>
</html>