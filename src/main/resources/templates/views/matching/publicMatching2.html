<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" >
<head>
<meta charset="UTF-8">
<title>Insert title here</title>
<link th:href="@{css/publicMatching2.css}" rel="stylesheet" type="text/css"/>
<link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/daterangepicker/daterangepicker.css" />
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/flatpickr/dist/flatpickr.min.css">

</head>
<body>
	<div class="navbar" th:replace="~{common/navbar.html :: navbar}"></div>
	<main class="inner-content d-flex justify-content-center">
		<form class="w-50 text-center" action="publicMatching-apply.mc" method="post">		
			<div class="publicMatching-wrap text-center">
				<div class="w-100">
					<a href="home.do"><img class="logo-image mb-4" src="image/logo-removebg.png" width="300"></a>
					<h1 class="h3 mb-2 fw-bold text-center">공개 매칭 신청</h1>
					<div class="page-num mb-3">
						<img src="image/icon/1page.png"></img>
						<img src="image/icon/2page-color-green.png"></img>
					</div>
					<div class="mb-5">
						<p><em>*</em> 아래 정보는 기존에 입력한 공개 매칭 설정 정보들입니다.<br>
						   <em>*</em> 아래 정보를 바탕으로 공개 매칭방이 생성됩니다. 정확하게 입력해주세요
						</p>
					</div>
				</div>
				
				<div class="icon-wrap d-flex justify-content-center mb-3">
					<div class="icon-container d-flex flex-column" data-letue="overDay" onclick="selectIcon(this)">
						   <img width="50" height="50" src="https://img.icons8.com/ios/50/calendar--v1.png" alt="calendar--v1"/>
						   	<strong>기간제 간병</strong>
						    <p class="fs-6">24시간 이상의<br>간병이 필요해요.</p>
					</div>
					<div class="icon-container d-flex flex-column" data-letue="underDay" onclick="selectIcon(this)">
	  						<img width="50" height="50" src="https://img.icons8.com/ios/50/time--v1.png" alt="time--v1"/>
	  						<strong>시간제 간병</strong>
					   	 	<p class="fs-6">24시간 미만의<br>간병이 필요해요</p>
					</div>
				</div>
				
				<div id="overDayInput" class="input-field hidden">
			        <div class="d-flex">
			            <label for="overDayStart">시작 날짜 및 시간:&nbsp;&nbsp;&nbsp;</label>
			            <input type="text" id="overDayStart" name="overDayStart" readonly>
			        </div>
			        <div class="d-flex mt-3">
			            <label for="overDayEnd">종료 날짜 및 시간:&nbsp;&nbsp;&nbsp;</label>
			            <input type="text" id="overDayEnd" name="overDayEnd" readonly>
			        </div>
			        <div id="overDaySummary" class="summary">
			            시작 날짜와 종료 날짜를 선택해주세요
			        </div>
			    </div>
				
			    
			    <div id="underDayInput" class="input-field hidden">
			        <div class="d-flex">
			            <label for="underDayPicker">간병 날짜 선택:&nbsp;&nbsp;&nbsp;</label>
			            <input type="text" id="underDayPicker" name="underDayPicker" readonly>
			        </div>
			        <div class="time-picker d-flex mt-3">
			            <label for="underDayStartTime">하루 간병 시작 시간:&nbsp;&nbsp;&nbsp;</label>
			            <input type="time" id="underDayStartTime" name="underDayStartTime">
			            <label for="underDayEndTime">&nbsp;&nbsp;&nbsp;종료 시간:&nbsp;&nbsp;&nbsp;</label>
			            <input type="time" id="underDayEndTime" name="underDayEndTime">
			        </div>
			        <div id="underDaySummary" class="summary">
			            원하시는 날과 시간을 선택해주세요
			        </div>
    		 </div> 
		</div>
				
			 <div class="symptom-selection-container">
			    <div class="instruction-text">
			        <p class="fw-bold fs-5"><img width="48" height="48" src="https://img.icons8.com/color/48/treatment-plan.png" alt="treatment-plan"/>&nbsp;&nbsp;환자에게 해당되는 증상을 선택해주세요<br>
			        <span class="multiple-selection-note"><em>(중복 선택 가능)</em></span>
			    </div>
			    <div class="symptom-buttons">
			        <div class="row mb-3">
			            <div class="col-3">
			                <button type="button" class="btn-radio" data-symptom="symptom1">치매</button>
			            </div>
			            <div class="col-3">
			                <button type="button" class="btn-radio" data-symptom="symptom2">섬망</button>
			            </div>
			            <div class="col-3">
			                <button type="button" class="btn-radio" data-symptom="symptom3">욕창</button>
			            </div>
			            <div class="col-3">
			                <button type="button" class="btn-radio" data-symptom="symptom4">하반신 마비</button>
			            </div>
			        </div>
  			        <div class="row mb-3">
			            <div class="col-3">
			                <button type="button" class="btn-radio" data-symptom="symptom5">전신 마비</button>
			            </div>
			            <div class="col-3">
			                <button type="button" class="btn-radio" data-symptom="symptom6">와상 환자</button>
			            </div>
			            <div class="col-3">
			                <button type="button" class="btn-radio" data-symptom="symptom7">기저귀 케어</button>
			            </div>
			            <div class="col-3">
			                <button type="button" class="btn-radio" data-symptom="symptom8">의식 없음</button>
			            </div>
			        </div>
   			        <div class="row mb-3">
			            <div class="col-3">
			                <button type="button" class="btn-radio" data-symptom="symptom9">석션</button>
			            </div>
			            <div class="col-3">
			                <button type="button" class="btn-radio" data-symptom="symptom10">피딩</button>
			            </div>
			            <div class="col-3">
			                <button type="button" class="btn-radio" data-symptom="symptom11">소변줄</button>
			            </div>
			            <div class="col-3">
			                <button type="button" class="btn-radio" data-symptom="symptom12">장루</button>
			            </div>
			        </div>
   			        <div class="row mb-3">
			            <div class="col-3">
			                <button type="button" class="btn-radio" data-symptom="symptom13">투석</button>
			            </div>
			            <div class="col-3">
			                <button type="button" class="btn-radio" data-symptom="symptom14">전염성 질환</button>
			            </div>
			            <div class="col-3">
			                <button type="button" class="btn-radio" data-symptom="symptom15">파킨슨</button>
			            </div>
			            <div class="col-3">
			                <button type="button" class="btn-radio" data-symptom="symptom16">정신 질환</button>
			            </div>
			        </div>
		        </div>
	        </div>
		        <div class="mobility-button d-flex flex-column mt-5">
				    <div class="instruction-text">
				        <p class="fw-bold fs-5"><img width="48" height="48" src="https://img.icons8.com/color/48/walking--v1.png" alt="walking--v1"/>&nbsp;&nbsp;환자의 거동 상태를 선택해주세요</p>
				    </div>
				    <div class="row mb-3">
				        <div class="col-3">
				            <button type="button" class="btn-radio mobility-option" data-symptom="mobility1">자가 보행</button>
				        </div>
				        <div class="col-3">
				            <button type="button" class="btn-radio mobility-option" data-symptom="mobility2">거동 불가</button>
				        </div>
				    </div>
				</div>
				<div class="gender-button d-flex flex-column mt-5">
				    <div class="instruction-text">
				        <p class="fw-bold fs-5"><img width="48" height="48" src="https://img.icons8.com/color/48/gender--v1.png" alt="gender--v1"/>&nbsp;&nbsp;선호하는 간병인의 성별을 선택해주세요.</p>
				    </div>
				    <div class="row mb-3">
				        <div class="col-3">
				            <button type="button" class="btn-radio gender-option" data-symptom="gender1">남성</button>
				        </div>
				        <div class="col-3">
				            <button type="button" class="btn-radio gender-option" data-symptom="gender2">여성</button>
				        </div>
				        <div class="col-3">
				            <button type="button" class="btn-radio gender-option" data-symptom="gender3">성별 무관</button>
				        </div>
				    </div>
				</div>
               	<div class="sign-btn mt-5 d-flex justify-content-center">
               		<button type="button" class="previous-btn me-3" th:onclick="history.back();"><span>이전</span></button>
					<button type="submit" class="apply-btn me-3"><span>공개 매칭 신청</span></button>
				</div>		
		</form>
	</main>
	<div class="footer" th:replace="~{common/footer.html :: footer}"></div>
	    <script src="https://cdn.jsdelivr.net/npm/jquery/dist/jquery.min.js"></script>

    <script src="https://cdn.jsdelivr.net/npm/jquery/dist/jquery.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/flatpickr"></script>
    <script src="https://npmcdn.com/flatpickr/dist/l10n/ko.js"></script>
    <script>
    
    // 질병,성별 항목 중복안되게
    function setupSingleSelection(className) {
        const buttons = document.querySelectorAll(`.${className}`);
        buttons.forEach(button => {
            button.addEventListener('click', function() {
                buttons.forEach(btn => btn.classList.remove('selected'));
                this.classList.add('selected');
            });
        });
    }
    setupSingleSelection('mobility-option');
    setupSingleSelection('gender-option');
    
    //날짜 선택
    function selectIcon(element) {
        $('.icon-container').removeClass('selected');
        $(element).addClass('selected');
        const selectedletue = $(element).data('letue');
        
        $('#overDayInput, #underDayInput').addClass('hidden');
        
        if (selectedletue === 'overDay') {
            $('#overDayInput').removeClass('hidden');
        } else if (selectedletue === 'underDay') {
            $('#underDayInput').removeClass('hidden');
        }
    }
    
    $(document).ready(function() {
        flatpickr.localize(flatpickr.l10ns.ko);

        // overDayInput 설정
        let overDayStartPicker = flatpickr("#overDayStart", {
            enableTime: true,
            dateFormat: "Y-m-d H:i",
            minDate: "today",
            locale: "ko",
            minuteIncrement: 30,
            onChange: updateOverDaySummary
        });

        let overDayEndPicker = flatpickr("#overDayEnd", {
            enableTime: true,
            dateFormat: "Y-m-d H:i",
            minDate: "today",
            locale: "ko",
            minuteIncrement: 30,
            onChange: updateOverDaySummary
        });

        function updateOverDaySummary() {
        	let start = overDayStartPicker.selectedDates[0];
        	let end = overDayEndPicker.selectedDates[0];
            
            if (start && end) {
                if (end <= start) {
                    $('#overDaySummary').html('<span class="error-message">종료 날짜와 시간은 시작 날짜와 시간 이후여야 합니다.</span>');
                    return;
                }
                
                let diffTime = Math.abs(end - start);
                let diffDays = Math.floor(diffTime / (1000 * 60 * 60 * 24));
                let diffHours = Math.floor((diffTime % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
                let diffMinutes = Math.floor((diffTime % (1000 * 60 * 60)) / (1000 * 60));
                
                let result = '선택한 기간: ';
                if (diffDays > 0) result += diffDays + '일 ';
                if (diffHours > 0) result += diffHours + '시간 ';
                if (diffMinutes > 0) result += diffMinutes + '분';
                
                $('#overDaySummary').text(result.trim());
            } else {
                $('#overDaySummary').text('날짜와 시간을 선택해주세요.');
            }
        }

        // underDayInput 설정
        flatpickr("#underDayPicker", {
            mode: "multiple",
            dateFormat: "Y년 m월 d일",
            minDate: "today",
            locale: "ko",
            onChange: updateUnderDaySummary
        });

        $('#underDayStartTime, #underDayEndTime').flatpickr({
            enableTime: true,
            noCalendar: true,
            dateFormat: "H:i",
            minuteIncrement: 30,
            time_24hr: true,
            onChange: updateUnderDaySummary
        });

        function updateUnderDaySummary() {
            let startTime = $('#underDayStartTime').val();
            let endTime = $('#underDayEndTime').val();
            let selectedDates = $("#underDayPicker")[0]._flatpickr.selectedDates;
            
            let timeDiff = 0;
            if (startTime && endTime) {
                let start = new Date(`2000-01-01T${startTime}`);
                let end = new Date(`2000-01-01T${endTime}`);
                
                if (end <= start) {
                    end.setDate(end.getDate() + 1);  // 다음 날로 설정
                }
                
                timeDiff = (end - start) / (1000 * 60 * 60);
            }

            let summaryText = `선택한 기간: 총 ${selectedDates.length}일`;
            if (timeDiff > 0) {
                summaryText += `, 하루 ${timeDiff}시간`;
            }

            $('#underDaySummary').text(summaryText);
        }

        // 아이콘 클릭 이벤트 설정
        $('.icon-container').on('click', function() {
            selectIcon(this);
        });
    });
    </script>
</body>
</html>