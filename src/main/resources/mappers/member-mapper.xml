<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org/DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.kh.dndncare.member.model.dao.MemberMapper">

	<!-- <select id="login" resultType="Member">
		select *
	 	from member
	 	where member_status = 'N' and member_id=#{memberId}
	</select> -->
	
	  <select id="login" resultType="Member">
	  	select *
	  	from member
	  	where member_status = 'N' and member_id=#{memberId}
	  </select>
	  
	  <select id="idCheck" resultType="_int">
	  	select count(*)
	  	from member
	  	where member_status = 'N' and member_id=#{id}	  
	  </select>
	  
	  

	<!-- ResultMap : 캘린더에 적합도록 매핑 -->
	<resultMap type="CalendarEvent" id="calendarResultMap">
		<id column="MAT_NO" property="matNo"/>
	  	<result column="TITLE" property="title"/>
		<result column="BEGIN_DT" property="start"/>
		<result column="END_DT" property="end"/>
		<result column="MONEY" property="money"/>
		<result column="HOSPTAL_NO" property="hosptalNo"/>
		<result column="HOSPTAL_ADDRESS" property="hosptalAddress"/>
		<result column="HOSPTAL_NAME" property="hosptalName"/>
	</resultMap>
	  
	  
	  
	<select id="caregiverCalendarEvent" resultMap="calendarResultMap">
		SELECT MAT_NO, '간병하기' AS TITLE, BEGIN_DT, END_DT, MONEY, HOSPTAL_NO, HOSPTAL_ADDRESS, HOSPTAL_NAME 
		FROM MATCHING
		        JOIN HOSPTAL USING(HOSPTAL_NO)
		WHERE MEMBER_NO = #{memberNo}
	</select>

	  <select id="selectAllMember" resultType="Member">		<!-- 멤버좀 확인할라구요 -->
		select *
		from member	  
	  </select>
	  
	  <insert id="enroll"  useGeneratedKeys="true">
	  	<selectKey resultType="_int" keyProperty="memberNo" order="BEFORE">
	  		select seq_mid.nextval from dual 
	  	</selectKey>
	  	insert into member
	  	values(#{memberNo}, #{memberId}, #{memberPwd}, #{memberName}, #{memberGender}, 
	  			#{memberNickName}, #{memberAge}, #{memberPhone}, #{memberEmail}, sysdate,
	  		 	#{memberAddress}, #{memberCategory}, 'N', #{memberNational}, null)  	
	  </insert>
	  
	  <insert id="enrollCareGiver">
	  	insert into caregiver
	  	values(#{memberNo}, #{careImg}, #{careIntro}, 
	  			#{minMoney}, #{maxMoney}, #{careJoinStatus}, #{careService})	  
	  </insert>
	  
	  
	<insert id="enrollInfoCategory">
		<foreach collection="infoCategory" item="item"  open="INSERT ALL" close="SELECT * FROM DUAL">
			into member_Info values(#{memberNo}, #{item})
		</foreach>
	</insert>
	  
	<insert id="enrollPatient">
	  	insert into patient
	  	values(seq_pid.nextval #{memberNo}, #{ptName}, #{careIntro}, 
	  			#{minMoney}, #{maxMoney}, #{careJoinStatus}, #{careService})	  
	  </insert>
	  
	  <select id="findIdResult" resultType="Member">
	  	select member_id,member_create_date,member_status,member_category,member_name
	  	from member
	  	where member_id=#{memberId} and member_phone=#{memberPhone}
	  </select>

</mapper>