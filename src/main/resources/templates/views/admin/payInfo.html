<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org">
<head>
<meta charset="UTF-8">
<title>든든케어 - 결제정보</title>
	<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz" crossorigin="anonymous"></script>
    <script src="https://code.jquery.com/jquery-3.2.1.js"></script>
	<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
	<!-- Editor's Style -->
	<link rel="stylesheet" href="https://uicdn.toast.com/editor/latest/toastui-editor.min.css" />
	<link href="css/careInformation.css" rel="stylesheet" type="text/css">
	<script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.8.0/Chart.min.js" crossorigin="anonymous"></script>
</head>
<body>
	<div th:replace="~{common/adminNavbarTemp :: navbarTemp}"></div>
	<div th:replace="~{common/adminSymbolTemp :: symbolTemp}"></div>
	
	
	
	<div class="container-fluid">
		<div class="row">
			<div th:replace="~{common/adminbarTemp :: sidebar}"></div>
			
			<main class="col-md-9 ms-sm-auto col-lg-10 px-md-4">
				<div class="row m-4" style="border:0px solid black; min-width:1500px;">
					<div class="col m-2" style="max-width:900px;max-height:506px;">
						<div class="d-flex justify-content-between">
						<h1>결제 정보</h1>
						<h3>2020~ 잊루일)</h3>
						</div>
						<canvas id="barChart" style="min-width:900px;max-width:900px;"></canvas>
					</div>
					<div class="col m-2" style="min-width:550px;max-width:550px;">
						<table class="m-4">
							<tr align="center" class="d-flex justify-content-between">
								<th width="300" style="border-right:2px solid lightgray"><h2>총 매칭 금액</h2></th>
								<td width="250"><h3>100,000원</h3></td>
							</tr>
							<tr align="center" class="d-flex justify-content-between">
								<th width="300" style="border-right:2px solid lightgray"><h2>평균 매칭 금액</h2></th>
								<td width="250"><h3>100,000원</h3></td>
							</tr>
							<tr align="center" class="d-flex justify-content-between">
								<th width="300" style="border-right:2px solid lightgray"><h2>최고 매칭 금액</h2></th>
								<td width="250"><h3>100,000원</h3></td>
							</tr>
							<tr align="center" class="d-flex justify-content-between">
								<th width="300" style="border-right:2px solid lightgray"><h2>최저 매칭 금액</h2></th>
								<td width="250"><h3>100,000원</h3></td>
							</tr>
						</table>
						<div class="m-4 p-4"></div>
						<div class="m-4">
							<select class="m-4 form-select" style="width:200px; height:40px;" name="selectCon"aria-label="Default select example">
							  <option selected value="0">일주일</option>
							  <option value="1">한달</option>
							  <option value="2">1년</option>
							</select>
						</div>
						<div id="selectScope"style="height:130px height:40px;"class="m-4 d-flex justify-content-center">
							<input type="date" name="weekScope" style="width:200px"class="form-control">
							<span class="m-2">~</span>
							<input type="date" name="weekScope" style="width:200px; background:lightgray"class="form-control" readonly="readonly">
							
							
						
						</div>
						<div id="dateName"style="height:130px height:40px;"class="d-flex justify-content-between">
							<span>시작 날짜</span>
							<span>끝 날짜</span>
						</div>
						
						<div align="center"class="m-4"><button class="btn btn-success" onclick="selectPayStatis()">검색하기</button></div>
					
					</div>
				
				</div>		
				
			</main>
		</div>
	</div>
	
	
	<script th:inline="javascript">

		function selectPayStatis(){


			switch(selectCon.value){
			case '0':
				let weeks = document.getElementsByName('weekScope');
				console.log(weeks[0].value);
				console.log(weeks[1].value);
				
				$.ajax({
					url:'weekPayTotal.adm',
					data:{data:weeks},
					success:data=>console.log('확인'),
					error:data=>console.log('ㅜㅜ')
				});
				
				
				
				
				return;
			case '1':
				
				return;
			case '2':
				
				return;
			}
			
			
			let s = document.getElementsByName('monthYScope');
			for(i of s){
				console.log(i.value);
			}
		}
		
			
	
			
		/*<![CDATA[*/
		const test = /*[[${psDp[0].memberNo}]]*/ 3;
		console.log(test);
		/*]]>*/

		const today = new Date();
		console.log(today);
		
		const getDateFormat = date => {
			const year = (date.getFullYear());
			const month = ('0'+(date.getMonth()+1)).slice(-2);
			const day = ('0'+date.getDate()).slice(-2);
			
			return year + '-' + month + '-' + day;
		}
		
		//console.log('뭐야ㅕ이거' + getDateFormat(today));
		
		
		// 막대그래프 (시작)
		const barCtx = document.getElementById('barChart');
		let chart = () => new Chart(barCtx, {
		    type: 'line',
		    data: {
		      labels: ['1', '2', '3', '4', '5', '6','7','1', '2', '3', '4', '5', '6','1', '2', '3', '4', '5', '6','1', '2', '3', '4', '5', '6'],
		      datasets: [{
		        		label: '시간제매칭',
		        		data: [12, 19, 3, 5, 2, 3],
		        		borderWidth: 2,
		        		borderColor: '#1D2D50',
		        		fill: false,
		        		backgroundColor: '#1D2D50',
		        		fontSize:24
		      			},
		      			{
	      				label: '기간제매칭',
		        		data: [5, 4, 3, 5, 2, 3],
		        		borderWidth: 1,
		        		borderColor: '#1E5F74',
		        		fill: false,
		        		backgroundColor: '#1E5F74',
		        		fontSize:24
		      			}]
		    },
		    options: {
		    	onClick : function(){
		    		console.log(chart.legend.legendItems)
		    		},
	    		legend: {
	                labels: {
	                    fontColor: 'black',
	                    fontSize : 24
	                }
	            }
		    }
		});
		chart();
		// 막대그래프 (끝)
		
			console.log(chart);
		
		//인풋에 변경효과주기
		const selectCon = document.getElementsByName('selectCon')[0];
		//console.log(selectScope);	//엥? 변수 지정안해도됨 
		selectCon.addEventListener('change',function(){
			
			switch(selectCon.value){
				case '0':			//일주일
					selectScope.innerHTML = '<input type="date" name="weekScope" style="width:200px"class="form-control" value="'+getDateFormat(today)+'">'+
					'<span class="m-2">~</span>'+
					'<input type="date" name="weekScope" style="width:200px; background:lightgray"class="form-control" readonly="readonly" value="'+addSevenDays(getDateFormat(today))+'">';
					setSevenDays();
					
					
					break;
				case '1': 			//한달
					selectScope.innerHTML =
						'<select name="monthYScope"style="width:90px" class="form-control">'+
						options +
						'<select>'+
						'<span class="mt-2">년</span>'+
						'<select name="monthMScope" style="width:80px" class="form-control">'+
						months +
						'</select>'+
						'<span class="mt-2">월</span>'+
						'<span class="m-2">~</span>'+
						'<select name="monthYScope"style="width:90px" class="form-control">'+
						options +
						'<select>'+
						'<span class="mt-2">년</span>'+
						'<select name="monthMScope" style="width:80px" class="form-control">'+
						months +
						'</select>'+
						'<span class="mt-2">월</span>';
					break;
				case '2': 			//일년
					selectScope.innerHTML =
						'<select name="monthYScope"style="width:188px" class="form-control">'+
						options +
						'<select>'+
						'<span class="mt-2">년</span>'+
						'<span class="m-2">~</span>'+
						'<select name="monthYScope"style="width:188px" class="form-control">'+
						options +
						'<select>'+
						'<span class="mt-2">년</span>';	
					break;
			}
		})
		
		//함수
		
				//함수 데이트
		function addSevenDays(dateString) {
		    // 입력된 날짜 문자열을 Date 객체로 변환
		    const date = new Date(dateString);
		    
		    // Date 객체에 7일을 더함
		    date.setDate(date.getDate() + 7);
		    
		    // 변환된 Date 객체를 'yyyy-mm-dd' 형식의 문자열로 변환
		    const year = date.getFullYear();
		    const month = String(date.getMonth() + 1).padStart(2, '0'); // 월은 0부터 시작하므로 1을 더해줌
		    const day = String(date.getDate()).padStart(2, '0');
		    
		    return year + '-' + month +  '-' + day;
		}
		//일주일계산
		function setSevenDays(){
			document.getElementsByName('weekScope')[0].addEventListener('change',function(){
				document.getElementsByName('weekScope')[1].value = addSevenDays(document.getElementsByName('weekScope')[0].value);
			})
		}
		
		//한달 선택시 도우기
		const todayYear = new Date().getFullYear();
		const todayMonth = new Date().getMonth()+1;
		let options = '';
		for(i = 2020 ; i <= todayYear ; i++){
			if(i == todayYear){
				options += '<option selected value="'+i+'">'+i+'</option>';
			}else{
				options += '<option value="'+i+'">'+i+'</option>';
				
			}
		}
		let months = '';
		for(i = 1; i <= 12 ; i++){
			if(i == todayMonth){
				months += '<option selected value="'+i+'">'+i+'</option>';
			}else{
				months += '<option value="'+i+'">'+i+'</option>';
				
			}
		}
		
		
		
		
	</script>
	
	
</body>
</html>